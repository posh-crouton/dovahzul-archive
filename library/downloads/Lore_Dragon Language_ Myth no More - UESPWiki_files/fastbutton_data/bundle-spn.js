// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-3.0
(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};if(e.r(t),e.d(t,{init:()=>k,monitorHighFidelity:()=>O,monitorTwitterArchiver:()=>j,systemStatus:()=>f,watchJob:()=>v}),void 0!==window.XMLHttpRequest){var s=class extends XMLHttpRequest{};Object.defineProperty(s.prototype,"responseURL",Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype,"responseURL"))}function n(e){return document.cookie.search(e)>=0}function i(e,t){const s=window[`HTML${e}Element`];if(void 0!==s){const e=Object.getOwnPropertyDescriptor(s.prototype,t);void 0!==e&&Object.defineProperty(s.prototype,`_wm_${t}`,e)}}i("Image","src"),i("Media","src"),i("Embed","src"),i("IFrame","src"),i("Script","src"),i("Link","href"),i("Anchor","href");const o=JSON;function a(e,t,n,i){return i=i||{},function(e,t,n,i,o){var a;if((a=window.XMLHttpRequest?new s:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){4==this.readyState&&n(a)},a.open(e,t,!0),i)for(var r in i)i.hasOwnProperty(r)&&a.setRequestHeader(r,i[r]);a.withCredentials=!0,a.send(o)}("POST","/__wb/web-archive/",(function(e){401===e.status?i.userNotLoggedIn&&i.userNotLoggedIn(e):e.status>=400?i.failure&&i.failure(e):i.success&&i.success(e)}),{"Content-Type":"application/json"},o.stringify({url:e,snapshot:t,tags:n||[]})),!1}var r;function l(e,t){return $("<div>",{id:t}).append($("<a>",{href:e}).html(e),$("<span>").html(" Saving... ").append(`<img src="${u}images/loading.gif" />`))}function c(e){var t=$("body").find(`#${e.job_id}`).first();if("success"===e.status){var s=`/web/${e.timestamp}/${e.original_url}`;t.children("a").first().attr("href",s).html(s),t.children("span").html('<span class="label label-success" style="display:inline-block;margin-left:2px"><span class="iconochive-Done"></span> Done!</span>'),!0===e.first_archive&&t.children("span").first().append('<span class="label label-default" style="display:inline-block;margin-left:2px"><span class="iconochive-First"></span> First Archive</span>')}else"error"===e.status&&t.children("span").html("").append('<span class="label label-danger" style="display:inline-block;margin-left:2px">Error! '+e.message+"</span>")}var p,u,d,h=[];function m(e){$.post("/save/status?_t="+Date.now(),{job_id_outlinks:e},(function(t){var s,n=!1;for(var i in t){var o=t[i];c(o),"pending"===o.status?n=!0:"success"===o.status&&-1===h.indexOf(o.job_id)?(h.push(o.job_id),s=o.job_id,$.ajax({url:`/save/status/${s}?_t=${Date.now()}`,success:function(e){if(e.outlinks&&"object"==typeof e.outlinks&&"0"!==Object.keys(e.outlinks)[0]&&Object.keys(e.outlinks).length){for(var t in e.outlinks){var s=e.outlinks[t];0===$("body").find("#"+s).length&&$("#spn-outlinks").append(l(t,s))}setTimeout((function(){m(e.job_id)}),6e3)}}})):"error"===o.status&&-1===h.indexOf(o.job_id)&&h.push(o.job_id)}!1!==n&&setTimeout((function(){m(e)}),6e3)}))}function f(){$.get("/save/status/system",(function(e){"ok"!==e.status&&$("#web_save_div").prepend(`<div class="alert alert-warning">${e.status}</div>`)}))}function v(e,t,s){p=e,u=t,d=s,r=$("#saving-msg"),n("logged-in-user")||$("#spn-option-mywebarchive").hide(),window.location.hash&&$("#spn-url").append(window.location.hash),$("#report-issue").on("click",(function(){$.ajax({url:`/save/_report-issue/${p}`,beforeSend:function(e){$("#report-issue-container").html(`Sending info... <img src="${u}images/loading.gif"/>`)},complete:function(e){$("#report-issue-container").html("Thank you!")}})})),y()}function g(e){const t=`/web/${e.timestamp}/${e.original_url}`;if("available"in e&&"message"in e)$("#spn-result").append($("<span>").text(e.message+" Visit page: "),$("<a>",{href:t}).html(t)),$("#spn-resources").hide(),$("#spn-option-mywebarchive").hide();else{if($("#spn-title").append($("<span>").html(" "),$("<span>",{class:"label label-success",style:"font-size: small"}).append($("<span>",{class:"iconochive-Done"}),$("<span>").html(" Done!"))),"first_archive"in e&&$("#spn-title").append($("<span>").html(" "),$("<span>",{class:"label label-default",style:"font-size: small"}).append($("<span>",{class:"iconochive-First"}),$("<span>").html(" First Archive "))),$("#spn-result").append($("<span>").html(" A snapshot was captured. Visit page: ").append($("<a>",{href:t}).html(t))),"screenshot"in e){const t=`/web/${e.timestamp}/${e.screenshot}`;$("#spn-result").append($("<div>").html("A screenshot was captured. View screenshot: ").append($("<a>",{href:t}).html(t)))}if("www.youtube.com"===new URL(e.original_url).hostname&&$("#spn-result").append("<div>It may take a few days for YouTube videos to become available for playback.</div>"),"message"in e&&$("#spn-result").append($("<div>").html(e.message)),"undefined"!==e.resources&&0!==e.resources.length||$("#spn-resources").hide(),e.outlinks&&"object"==typeof e.outlinks&&"0"!==Object.keys(e.outlinks)[0]&&Object.keys(e.outlinks).length){for(var s in $("#spn-outlinks").append("<strong>Saving outlinks and their embedded resources</strong><br />"),e.outlinks)$("#spn-outlinks").append(l(s,e.outlinks[s]));m(p)}$("<div>",{class:"text-center"}).append($("<a>",{href:"/save"}).html("Return to Save Page Now")).insertAfter("#spn-outlinks"),n("logged-in-user")&&n("logged-in-sig")&&$("#wm-save-mywebarchive")[0].checked?(a(e.original_url,e.timestamp),$("#wm-save-snapshot-success").show(),$("#spn-option-mywebarchive").delay(2e3).hide(0)):$("#spn-option-mywebarchive").hide(0)}r.html("")}var w=0;function b(e){if(5===(w+=1))return g(e),void function(e){$("#spn-result").append("<div>There was a delay in registering this snapshot with the Wayback Machine.</div>"),"first_archive"in e?$("#spn-result").append("<div>The snapshot may not be available right now, please try again later.</div>"):$("#spn-result").append("<div>You may be redirected to a previous version right now. This snapshot will be available later.</div>")}(e);$.ajax({url:"/web/timemap/",data:{url:e.original_url,from:e.timestamp,limit:1,_t:Date.now()},success:function(t){""!==t&&void 0!==t?g(e):setTimeout((function(){b(e)}),d)},error:function(){setTimeout((function(){b(e)}),d)}})}function y(){$.ajax({url:`/save/status/${p}?_t=${Date.now()}`,beforeSend:function(e){""===r.html()&&r.append("Saving... ",`<img src="${u}images/loading.gif"/>`)},success:function(e){if(e.resources){var t=e.resources.length;t>0&&($("#spn-elements-counter-container").show(),$("#spn-elements-counter").html(t));var s=e.resources.join("\n");""!=s&&$("#spn-resources").val(s)}if(e.download_size){var n=Math.round(e.download_size/e.total_size*100),i=function(e){var t=-1;do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+[" kB"," MB"," GB"][t]}(e.download_size);n>0&&(i+=" ("+n.toString()+"%)"),$("#spn-progress").show(),$("#spn-progress > div.progress-bar").attr("style","width: "+n.toString()+"%").attr("aria-valuenow",n).text(i)}var o;"success"===e.status?setTimeout((function(){b(e)}),d):"error"===e.status?(void 0===(o=e.message)&&(o="Internal server error."),r.html(""),$("#spn-result").append($("<p>",{class:"text-danger"}).html(o),$("<a>",{href:"/save"}).html("Return to Save Page Now")),$("#spn-resources").hide()):setTimeout(y,d)},error:function(){setTimeout(y,d)}})}function k(){$("#web-save-form").on("submit",(function(e){e.preventDefault();var t=$("#web-save-url-input").val(),s=$("#web-save-form")[0];$(s).attr("action","/save/"+t),s.submit()})),$(document).ready((function(){document.cookie.search("logged-in-user")>=0&&document.cookie.search("logged-in-sig")>=0&&($("#wm-save-option, #wm-capture-screenshot, #wm-capture-outlinks, #wm-email-result, #wm-wacz").show(),$("#wm-auth-features").hide())}))}const _=/^(https?:\/\/)?twitter.com\//;function j(){$("#web-save-url-input").on("input",(function(){!function(e){try{if(e&&_.test(e)>-1){/^((http|https):\/\/)/.test(e)||(e="https://"+e);const t=new URL(e),s=t.pathname.substr(1);if("twitter.com"===t.host&&s.length>=3&&-1===s.indexOf("/"))return!0}}catch(e){console.log(e)}return!1}($(this).val())?$("#wm-twitter-archiver").hide():$("#wm-twitter-archiver").show()}))}function O(){$("#high_fidelity").on("click",(function(){const e="#wm-capture-screenshot, #wm-save-option, #wm-error-pages, #wm-capture-outlinks";$(this)[0].checked?$(e).hide():$(e).show()}))}window.spn=t})();
// @license-end
